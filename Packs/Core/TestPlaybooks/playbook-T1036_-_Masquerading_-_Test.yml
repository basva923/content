id: T1036 - Masquerading - Test
version: -1
contentitemexportablefields:
  contentitemfields: {}
name: T1036 - Masquerading - Test
description: |-
  This playbook tests the 'T1036 - Masquerading' playbook, which is part of the 'Core' pack. The playbook includes the following conducted tests:
  - Checks the handling of malicious verdicts.
  - Validate the enrichment of verdicts with malicious IOCs.
  - Validate the conditional task to determine if the command line is malicious and handle the alert as a true positive.
  - Validate the containment actions taken in response to the identified malicious IOCs.
  - Validate the actions that were taken exist in the incident context.
starttaskid: "0"
tasks:
  "0":
    id: "0"
    taskid: 8bd038f8-98ff-49f1-8dd8-3b6d1868c638
    type: start
    task:
      id: 8bd038f8-98ff-49f1-8dd8-3b6d1868c638
      version: -1
      name: ""
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "12"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 450,
          "y": 80
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "2":
    id: "2"
    taskid: ceefb00d-2c88-422e-8112-aec3886e2a24
    type: regular
    task:
      id: ceefb00d-2c88-422e-8112-aec3886e2a24
      version: -1
      name: Set Endpoint ID
      description: Set a value in context under the key you entered.
      scriptName: Set
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "4"
    scriptarguments:
      key:
        simple: Endpoints
      value:
        simple: '["0cc51a9cd88147e4b70cd83e93ab5814","47bdca96e01b45b38bd9d3a80f2b9dbe","e02ad5e911094a358a271be1c9833284","6aec3d18d2404b3e84da227948583c4e","8b4aecf600f14313b23f7f31ed64b58c","561e3c2320884d979353513cf2fd14f2","98210476acd34d8b877e55b83196da29","ac848acbd7504115b6624c9b1d755000"]'
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 450,
          "y": 570
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "3":
    id: "3"
    taskid: b691b21d-e199-4b0d-813e-d947ea8306f9
    type: regular
    task:
      id: b691b21d-e199-4b0d-813e-d947ea8306f9
      version: -1
      name: Get Endpoints
      description: Gets a list of endpoints, according to the passed filters. If there are no filters, all endpoints are returned. Filtering by multiple fields will be concatenated using AND condition (OR is not supported). Maximum result set size is 100. Offset is the zero-based number of endpoint from the start of the result set (start by counting from 0).
      script: '|||core-get-endpoints'
      type: regular
      iscommand: true
      brand: ""
    nexttasks:
      '#none#':
      - "2"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 450,
          "y": 400
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "4":
    id: "4"
    taskid: 3a22a7d4-5a8d-4a24-88bf-a886c9e1e167
    type: regular
    task:
      id: 3a22a7d4-5a8d-4a24-88bf-a886c9e1e167
      version: -1
      name: Compare Endpoints ID
      description: Compare  two lists and put the differences in context.
      scriptName: CompareLists
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "6"
    scriptarguments:
      left:
        complex:
          root: Core.Endpoint
          accessor: endpoint_id
      right:
        complex:
          root: Endpoints
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 450,
          "y": 750
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "5":
    id: "5"
    taskid: b2edc4a5-9adc-465b-8fda-85f054ce148e
    type: playbook
    task:
      id: b2edc4a5-9adc-465b-8fda-85f054ce148e
      version: -1
      name: T1036 - Masquerading
      description: |-
        This playbook handles masquerading alerts based on the MITRE T1036 technique.
        An attacker might leverage Microsoft Windows well-known image names to run malicious processes without being caught.

        **Attacker's Goals:**

        An attacker is attempting to masquerade as standard windows images by using a trusted name to execute malicious code.

        **Investigative Actions:**

        Investigate the executed process image and verify if it is malicious using:

        * XDR trusted signers
        * VT trusted signers
        * VT detection rate
        * NSRL DB

        **Response Actions**

        The playbook's first response action is a containment plan which is based on the initial data provided within the alert. In that phase, the playbook will execute:

        * Auto block indicators
        * Auto file quarantine
        * Manual endpoint isolation

        When the playbook executes, it checks for additional activity using the Endpoint Investigation Plan playbook, and another phase, which includes containment and eradication, is executed.

        This phase will execute the following containment actions:

        * Manual block indicators
        * Manual file quarantine
        * Auto endpoint isolation

        And the following eradication actions:

        * Manual process termination
        * Manual file deletion
        * Manual reset of the userâ€™s password

        External resources:

        [MITRE Technique T1036](https://attack.mitre.org/techniques/T1036/)

        [Possible Microsoft process masquerading](https://docs-cortex.paloaltonetworks.com/r/Cortex-XDR-Analytics-Alert-Reference/Possible-Microsoft-process-masquerading)
      playbookName: T1036 - Masquerading
      type: playbook
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "24"
    scriptarguments:
      AutoCloseAlert:
        simple: "True"
      AutoContainment:
        simple: "True"
      AutoEradication:
        simple: "False"
      AutoRecovery:
        simple: "True"
      CommentToAdd:
        simple: '${alert.name}. Alert ID: ${alert.id}'
      FilePath:
        complex:
          root: alert
          accessor: initiatorpath
      FileRemediation:
        simple: Quarantine
      FileSHA256:
        complex:
          root: alert
          accessor: initiatorsha256
      IP:
        complex:
          root: alert
          accessor: hostip
      ShouldOpenTicket:
        simple: "False"
      ZendeskSubject:
        simple: XSIAM Incident ID - ${parentIncidentFields.incident_id}
      addCommentPerEndpoint:
        simple: "True"
      description:
        simple: ${parentIncidentFields.description}. ${parentIncidentFields.xdr_url}
      serviceNowShortDescription:
        simple: XSIAM Incident ID - ${parentIncidentFields.incident_id}
    separatecontext: false
    continueonerrortype: ""
    loop:
      iscommand: false
      exitCondition: ""
      wait: 1
      max: 100
    view: |-
      {
        "position": {
          "x": 450,
          "y": 1460
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "6":
    id: "6"
    taskid: d11ef204-f2fb-45df-800e-14a15ee63074
    type: regular
    task:
      id: d11ef204-f2fb-45df-800e-14a15ee63074
      version: -1
      name: Set alert agentid
      description: commands.local.cmd.set.incident
      script: Builtin|||setAlert
      type: regular
      iscommand: true
      brand: Builtin
    nexttasks:
      '#none#':
      - "7"
    scriptarguments:
      agentid:
        complex:
          root: ListCompare
          accessor: Both
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 450,
          "y": 920
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "7":
    id: "7"
    taskid: bbd9ef40-861b-4b94-855f-f1956249bea1
    type: regular
    task:
      id: bbd9ef40-861b-4b94-855f-f1956249bea1
      version: -1
      name: Set alert hostip
      description: commands.local.cmd.set.incident
      script: Builtin|||setAlert
      type: regular
      iscommand: true
      brand: Builtin
    nexttasks:
      '#none#':
      - "8"
    scriptarguments:
      hostip:
        simple: 1.1.1.1
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 450,
          "y": 1100
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "8":
    id: "8"
    taskid: 421e7433-db1b-4d15-84d9-f772689c8675
    type: regular
    task:
      id: 421e7433-db1b-4d15-84d9-f772689c8675
      version: -1
      name: Set alert initiatorsha256
      description: commands.local.cmd.set.incident
      script: Builtin|||setAlert
      type: regular
      iscommand: true
      brand: Builtin
    nexttasks:
      '#none#':
      - "5"
    scriptarguments:
      initiatorsha256:
        simple: fffee99d8b6a3d291eea8cc3441132f721101378c75eadf92fa49fe891845364
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 450,
          "y": 1280
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "12":
    id: "12"
    taskid: 08b37def-8739-4e42-89be-29b4ea53e4fc
    type: regular
    task:
      id: 08b37def-8739-4e42-89be-29b4ea53e4fc
      version: -1
      name: Clear Context
      description: |-
        Delete field from context.

        This automation runs using the default Limited User role, unless you explicitly change the permissions.
        For more information, see the section about permissions here:
        https://docs-cortex.paloaltonetworks.com/r/Cortex-XSOAR/6.10/Cortex-XSOAR-Administrator-Guide/Automations
      scriptName: DeleteContext
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "3"
    scriptarguments:
      all:
        simple: "yes"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 450,
          "y": 220
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "13":
    id: "13"
    taskid: dfbcb172-0004-4920-834b-cc677555849a
    type: regular
    task:
      id: dfbcb172-0004-4920-834b-cc677555849a
      version: -1
      name: Remove file from block list
      description: Removes requested files from block list.
      script: '|||core-remove-blocklist-files'
      type: regular
      iscommand: true
      brand: ""
    nexttasks:
      '#none#':
      - "14"
    scriptarguments:
      hash_list:
        simple: fffee99d8b6a3d291eea8cc3441132f721101378c75eadf92fa49fe891845364
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 690,
          "y": 5040
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "14":
    id: "14"
    taskid: f7344c3e-664f-4823-8760-e8b234902e72
    type: condition
    task:
      id: f7344c3e-664f-4823-8760-e8b234902e72
      version: -1
      name: Verify containment action succeed
      description: Verification of the success of the containment actions.
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "15"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isNotEmpty
          left:
            value:
              complex:
                root: Core.blocklist
                accessor: added_hashes
            iscontext: true
          right:
            value: {}
      - - operator: isEqualString
          left:
            value:
              complex:
                root: parentIncidentFields
                accessor: severity
            iscontext: true
          right:
            value:
              simple: high
          ignorecase: true
      - - operator: isNotEmpty
          left:
            value:
              complex:
                root: parentIncidentContext
                accessor: BlockedFilesHash
            iscontext: true
      - - operator: isEqualString
          left:
            value:
              complex:
                root: parentIncidentContext
                accessor: IsolatedEndpointsID
            iscontext: true
          right:
            value:
              complex:
                root: ListCompare
                accessor: Both
            iscontext: true
          ignorecase: true
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 690,
          "y": 5210
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "15":
    id: "15"
    taskid: ab6a8276-7b28-48d9-8408-52e2185521e8
    type: regular
    task:
      id: ab6a8276-7b28-48d9-8408-52e2185521e8
      version: -1
      name: Make test fail
      description: Prints an error entry with a given message
      scriptName: PrintErrorEntry
      type: regular
      iscommand: false
      brand: ""
    scriptarguments:
      message:
        simple: The test playbook has failed. Please check the reason why the file hash is not being added to the block list.
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 950,
          "y": 5400
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "16":
    id: "16"
    taskid: 3eda8324-7eda-409f-8aac-1bb0bbe3e58a
    type: regular
    task:
      id: 3eda8324-7eda-409f-8aac-1bb0bbe3e58a
      version: -1
      name: Remove file from block list
      description: Removes requested files from block list.
      script: '|||core-remove-blocklist-files'
      type: regular
      iscommand: true
      brand: ""
    nexttasks:
      '#none#':
      - "17"
    scriptarguments:
      hash_list:
        simple: fffee99d8b6a3d291eea8cc3441132f721101378c75eadf92fa49fe891845364
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 690,
          "y": 5040
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "17":
    id: "17"
    taskid: 49ac1d43-1eae-444c-8210-83d78380dc40
    type: condition
    task:
      id: 49ac1d43-1eae-444c-8210-83d78380dc40
      version: -1
      name: Verify containment action succeed
      description: Verification of the success of the containment actions.
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "18"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isNotEmpty
          left:
            value:
              complex:
                root: Core.blocklist
                accessor: added_hashes
            iscontext: true
          right:
            value: {}
      - - operator: isEqualString
          left:
            value:
              complex:
                root: parentIncidentFields
                accessor: severity
            iscontext: true
          right:
            value:
              simple: high
          ignorecase: true
      - - operator: isNotEmpty
          left:
            value:
              complex:
                root: parentIncidentContext
                accessor: BlockedFilesHash
            iscontext: true
      - - operator: isEqualString
          left:
            value:
              complex:
                root: parentIncidentContext
                accessor: IsolatedEndpointsID
            iscontext: true
          right:
            value:
              complex:
                root: ListCompare
                accessor: Both
            iscontext: true
          ignorecase: true
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 690,
          "y": 5210
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "18":
    id: "18"
    taskid: 7cd33346-18d0-403b-84ce-92b7e0b0a311
    type: regular
    task:
      id: 7cd33346-18d0-403b-84ce-92b7e0b0a311
      version: -1
      name: Make test fail
      description: Prints an error entry with a given message
      scriptName: PrintErrorEntry
      type: regular
      iscommand: false
      brand: ""
    scriptarguments:
      message:
        simple: The test playbook has failed. Please check the reason why the file hash is not being added to the block list.
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 950,
          "y": 5400
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "19":
    id: "19"
    taskid: 4ad740f5-84b8-473b-8131-5fb8077caa75
    type: regular
    task:
      id: 4ad740f5-84b8-473b-8131-5fb8077caa75
      version: -1
      name: Remove file from block list
      description: Removes requested files from block list.
      script: '|||core-remove-blocklist-files'
      type: regular
      iscommand: true
      brand: ""
    nexttasks:
      '#none#':
      - "20"
    scriptarguments:
      hash_list:
        simple: fffee99d8b6a3d291eea8cc3441132f721101378c75eadf92fa49fe891845364
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 690,
          "y": 5040
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "20":
    id: "20"
    taskid: b6bbc3c8-e247-4cb0-89db-b8531500cdbe
    type: condition
    task:
      id: b6bbc3c8-e247-4cb0-89db-b8531500cdbe
      version: -1
      name: Verify containment action succeed
      description: Verification of the success of the containment actions.
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "21"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isNotEmpty
          left:
            value:
              complex:
                root: Core.blocklist
                accessor: added_hashes
            iscontext: true
          right:
            value: {}
      - - operator: isEqualString
          left:
            value:
              complex:
                root: parentIncidentFields
                accessor: severity
            iscontext: true
          right:
            value:
              simple: high
          ignorecase: true
      - - operator: isNotEmpty
          left:
            value:
              complex:
                root: parentIncidentContext
                accessor: BlockedFilesHash
            iscontext: true
      - - operator: isEqualString
          left:
            value:
              complex:
                root: parentIncidentContext
                accessor: IsolatedEndpointsID
            iscontext: true
          right:
            value:
              complex:
                root: ListCompare
                accessor: Both
            iscontext: true
          ignorecase: true
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 690,
          "y": 5210
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "21":
    id: "21"
    taskid: b862efb9-6dc7-4737-88a5-977a53ca5c71
    type: regular
    task:
      id: b862efb9-6dc7-4737-88a5-977a53ca5c71
      version: -1
      name: Make test fail
      description: Prints an error entry with a given message
      scriptName: PrintErrorEntry
      type: regular
      iscommand: false
      brand: ""
    scriptarguments:
      message:
        simple: The test playbook has failed. Please check the reason why the file hash is not being added to the block list.
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 950,
          "y": 5400
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "22":
    id: "22"
    taskid: 0ad0f0b6-2017-405c-8c4a-04256d7cc88d
    type: regular
    task:
      id: 0ad0f0b6-2017-405c-8c4a-04256d7cc88d
      version: -1
      name: Remove file from block list
      description: Removes requested files from block list.
      script: '|||core-remove-blocklist-files'
      type: regular
      iscommand: true
      brand: ""
    scriptarguments:
      hash_list:
        simple: fffee99d8b6a3d291eea8cc3441132f721101378c75eadf92fa49fe891845364
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 690,
          "y": 5040
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "24":
    id: "24"
    taskid: ab8a44c3-3e51-46e9-82ef-4b9dc61efe03
    type: condition
    task:
      id: ab8a44c3-3e51-46e9-82ef-4b9dc61efe03
      version: -1
      name: Verify containment action succeed
      description: Verification of the success of the containment actions.
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "26"
      "yes":
      - "25"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isNotEmpty
          left:
            value:
              complex:
                root: Core.blocklist
                accessor: added_hashes
            iscontext: true
      - - operator: isEqualString
          left:
            value:
              complex:
                root: parentIncidentFields
                accessor: severity
            iscontext: true
          right:
            value:
              simple: high
          ignorecase: true
      - - operator: isNotEmpty
          left:
            value:
              complex:
                root: parentIncidentContext
                accessor: BlockedFilesHash
            iscontext: true
          ignorecase: true
      - - operator: isEqualString
          left:
            value:
              complex:
                root: parentIncidentContext
                accessor: IsolatedEndpointsID
            iscontext: true
          right:
            value:
              complex:
                root: ListCompare
                accessor: Both
            iscontext: true
          ignorecase: true
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 450,
          "y": 1640
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "25":
    id: "25"
    taskid: a6ecf5ee-83c7-447e-82de-c7ced7fe6d56
    type: title
    task:
      id: a6ecf5ee-83c7-447e-82de-c7ced7fe6d56
      version: -1
      name: Done
      type: title
      iscommand: false
      brand: ""
      description: ''
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 440,
          "y": 2000
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "26":
    id: "26"
    taskid: 96d3311e-dd27-403d-85f6-a129923df14c
    type: regular
    task:
      id: 96d3311e-dd27-403d-85f6-a129923df14c
      version: -1
      name: Make test fail
      description: Prints an error entry with a given message
      scriptName: PrintErrorEntry
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "25"
    scriptarguments:
      message:
        simple: The test playbook has failed. Please check the reason why the file hash is not being added to the block list.
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 760,
          "y": 1810
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
view: |-
  {
    "linkLabelsPosition": {},
    "paper": {
      "dimensions": {
        "height": 5415,
        "width": 890,
        "x": 440,
        "y": 80
      }
    }
  }
inputs: []
outputs: []
tests:
- No tests (auto formatted)
fromversion: 6.6.0
marketplaces:
- marketplacev2